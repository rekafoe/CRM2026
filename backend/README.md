# üöÄ CRM Backend - Quick Start

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
cd backend
npm install
```

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

- –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏ `initDB()` —Å–∞–º —Å–æ–∑–¥–∞—ë—Ç `data.db`, –≤–∫–ª—é—á–∞–µ—Ç `PRAGMA foreign_keys` –∏ –ø—Ä–æ–≥–æ–Ω—è–µ—Ç –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏–∑ `src/migrations`.
- –ß—Ç–æ–±—ã —É–¥–∞–ª–∏—Ç—å –±–∞–∑—É, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ç–µ—Ä–µ—Ç—å —Ñ–∞–π–ª `backend/data.db` (–∏–ª–∏ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ in-memory –≤ —Ç–µ—Å—Ç–∞—Ö).
- –ï—Å–ª–∏ –Ω—É–∂–Ω—ã –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞ (—Å—Ç–∞—Ç—É—Å—ã, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –ø—Ä–µ—Å–µ—Ç—ã –∏ –º–∞—Ç–µ—Ä–∏–∞–ª—ã), –∑–∞–ø—É—Å—Ç–∏:  
  ```bash
  npm run seed:demo
  ```
  –°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≥–æ–Ω—è–µ—Ç—Å—è –ø–æ–≤–µ—Ä—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ë–î –∏ –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ—Ç, –µ—Å–ª–∏ –∑–∞–ø–∏—Å–∏ —É–∂–µ –µ—Å—Ç—å.

## üèóÔ∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
```bash
npm run dev      # Development —Å hot-reload
npm run build    # –ö–æ–º–ø–∏–ª—è—Ü–∏—è TypeScript
npm start        # Production —Ä–µ–∂–∏–º
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
npm test         # –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
```

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î

```
–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:
  ‚îú‚îÄ‚îÄ users, order_statuses, orders, items, order_files
  ‚îú‚îÄ‚îÄ materials, material_moves, material_reservations
  ‚îú‚îÄ‚îÄ preset_categories, preset_items, preset_extras
  ‚îú‚îÄ‚îÄ products, product_parameters, product_operations_link
  ‚îú‚îÄ‚îÄ pricing_* (–≥–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è)
  ‚îî‚îÄ‚îÄ telegram_users, notification_logs –∏ –¥—Ä.
```

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ API endpoints

```
GET  /api/products              # –°–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
GET  /api/products/:id          # –î–µ—Ç–∞–ª–∏ –ø—Ä–æ–¥—É–∫—Ç–∞
POST /api/products/:id/calculate # –†–∞—Å—á–µ—Ç —Ü–µ–Ω—ã

GET  /api/operations            # –°–ø–∏—Å–æ–∫ –æ–ø–µ—Ä–∞—Ü–∏–π (auth)
POST /api/orders                # –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞

GET  /health                    # Healthcheck
```

## üîß –ú–∏–≥—Ä–∞—Ü–∏–∏

- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã –ª–µ–∂–∞—Ç –≤ `src/migrations` –∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ `initDB()`.
- –î–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ —Å legacy-—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Å—Ç–∞—Ä—Ç–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è `20240101000000_initial_schema.ts` ‚Äî –æ–Ω–∞ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –æ–±—â—É—é —Å—Ö–µ–º—É –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–º–µ—Å—Ç–µ —Å –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ –º–∏–≥—Ä–∞—Ü–∏—è–º–∏.
- –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ —Ç–µ–ø–µ—Ä—å –Ω–µ –ø–æ–¥–º–µ—à–∏–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –ò—Å–ø–æ–ª—å–∑—É–π `npm run seed:demo`, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –Ω–∞–ø–æ–ª–Ω–∏—Ç—å –±–∞–∑—É –ø—Ä–∏–º–µ—Ä–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏.

**–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏:** `/docs/migration-reorganization-plan.md`

## üìù –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `/docs/pricing-architecture.md` - –ï–¥–∏–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è
- `/docs/flexible-calculator-system.md` - –ì–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–ø–µ—Ä–∞—Ü–∏–π
- `/docs/api-operations.md` - API –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π
- `/docs/migration-reorganization-plan.md` - –ü–ª–∞–Ω –ø–æ –º–∏–≥—Ä–∞—Ü–∏—è–º

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞
npm install

# 2. (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
npm run seed:demo

# 3. –ó–∞–ø—É—Å–∫
npm run dev

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞
curl http://localhost:3001/api/products
```

## üöÄ –î–µ–ø–ª–æ–π –Ω–∞ Railway (backend)

- **Service Root Directory**: `backend`
- **Build/Run**: –ø—Ä–æ—â–µ –≤—Å–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π Docker build (—Ñ–∞–π–ª —É–∂–µ –µ—Å—Ç—å: `backend/Dockerfile`)
- **–í–∞–∂–Ω–æ**: Railway —Å–∞–º –≤—ã—Å—Ç–∞–≤–ª—è–µ—Ç `PORT` ‚Äî –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `process.env.PORT` (—É –Ω–∞—Å —Ç–∞–∫ –∏ –µ—Å—Ç—å)

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (Railway Variables)

- `NODE_ENV=production`
- `CORS_ORIGIN=https://<your-vercel-domain>`
- `JWT_SECRET=<random-long-secret>`
- `DB_FILE=data.db` (–∏–ª–∏ –ø—É—Ç—å –≤ volume, –Ω–∞–ø—Ä–∏–º–µ—Ä: `/data/data.db`)

### SQLite –Ω–∞ Railway

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é SQLite-—Ñ–∞–π–ª —Å–æ–∑–¥–∞—Å—Ç—Å—è –≤ —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞. –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å ‚Äî –ø–æ–¥–∫–ª—é—á–∏—Ç–µ Railway Volume –∏ —É–∫–∞–∂–∏—Ç–µ `DB_FILE` –Ω–∞ –ø—É—Ç—å –≤–Ω—É—Ç—Ä–∏ volume.

## üõ†Ô∏è –ü–æ–ª–µ–∑–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã

```bash
# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö / –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
npm run seed:demo   # –ù–∞–ø–æ–ª–Ω–∏—Ç—å –ë–î –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º–∏ –∑–∞–ø–∏—Å—è–º–∏ (–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ)

# –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
npm run dev         # Dev —Å–µ—Ä–≤–µ—Ä
npm run build       # –°–±–æ—Ä–∫–∞
npm start           # Production

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
npm test            # –¢–µ—Å—Ç—ã
```

## üéâ –ì–æ—Ç–æ–≤–æ!

–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ `http://localhost:3001`

–ü—Ä–æ–¥—É–∫—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã: `http://localhost:3001/api/products`

