# Рефакторинг ServiceVariantsTable

## Проблема

Оригинальный файл `ServiceVariantsTable.tsx` содержал **1516 строк кода**, что делало его:
- Сложным для понимания
- Трудным для поддержки
- Невозможным для тестирования
- С большим количеством дублирующегося кода

## Решение

Компонент разбит на модульную структуру:

### Структура файлов

```
components/admin/services/components/
├── ServiceVariantsTable.tsx          # Основной компонент (~540 строк)
├── ServiceVariantsTable.types.ts     # Типы и интерфейсы
├── ServiceVariantsTable.utils.ts     # Утилиты для группировки
├── PriceRangeCells.tsx               # Компоненты для ячеек диапазонов
├── TierRangeModal.tsx                # Модальное окно для диапазонов
└── hooks/
    ├── useServiceVariants.ts         # Хук для загрузки вариантов
    ├── useVariantEditing.ts          # Хук для редактирования
    ├── useTierModal.ts               # Хук для модального окна
    └── useVariantOperations.ts       # Хук для операций с вариантами
```

### Что было вынесено

1. **Типы** (`ServiceVariantsTable.types.ts`)
   - `VariantWithTiers`
   - `TierRangeModalState`
   - `GroupedVariants`
   - Props для компонентов

2. **Утилиты** (`ServiceVariantsTable.utils.ts`)
   - `getVariantLevel()` - определение уровня вложенности
   - `groupVariantsByType()` - группировка вариантов
   - `calculateCommonRanges()` - вычисление общих диапазонов
   - `createVariantsMap()` - создание Map для поиска

3. **Хуки**
   - `useServiceVariants` - загрузка и управление вариантами
   - `useVariantEditing` - редактирование названий и параметров
   - `useTierModal` - управление модальным окном диапазонов
   - `useVariantOperations` - CRUD операции с вариантами и диапазонами

4. **Компоненты**
   - `PriceRangeCells` - рендеринг ячеек диапазонов
   - `PriceRangeHeaders` - рендеринг заголовков диапазонов
   - `TierRangeModal` - модальное окно для добавления/редактирования диапазонов

## Результат

- **Основной файл**: с 1516 строк до ~540 строк (сокращение на 64%)
- **Модульность**: каждый модуль отвечает за свою область
- **Переиспользуемость**: хуки и компоненты можно использовать в других местах
- **Тестируемость**: каждый модуль можно тестировать изолированно
- **Поддерживаемость**: изменения в одном месте не затрагивают другие

## Миграция

Старый файл сохранен как `ServiceVariantsTable.old.tsx` для справки.

Все функции работают так же, как и раньше, но код стал более организованным и понятным.
