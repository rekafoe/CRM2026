# ‚úÖ –ì–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–≤ - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

## –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. **–ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö** 
üìÅ `backend/migrations/20250202000001_add_flexible_operations.ts`

–†–∞—Å—à–∏—Ä–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `post_processing_services` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –æ–ø–µ—Ä–∞—Ü–∏–π:
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è: `operation_type`, `price_unit`, `setup_cost`, `min_quantity`, `parameters`
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `product_operations_link` (—Å–≤—è–∑—å –ø—Ä–æ–¥—É–∫—Ç‚Üí–æ–ø–µ—Ä–∞—Ü–∏–∏)
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `operation_pricing_rules` (–ø—Ä–∞–≤–∏–ª–∞ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω seed –±–∞–∑–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (–ø–µ—á–∞—Ç—å, —Ä–µ–∑–∫–∞, –ª–∞–º–∏–Ω–∞—Ü–∏—è, —Ñ–∞–ª—å—Ü–æ–≤–∫–∞ –∏ —Ç.–ø.)

### 2. **–ì–∏–±–∫–∏–π —Å–µ—Ä–≤–∏—Å —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è**
üìÅ `backend/src/modules/pricing/services/flexiblePricingService.ts`

–ù–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å `FlexiblePricingService` –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ü–µ–Ω —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º—É –æ–ø–µ—Ä–∞—Ü–∏–π:
- ‚úÖ –†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –µ–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è
- ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è (—Å–∫–∏–¥–∫–∏, –Ω–∞–¥–±–∞–≤–∫–∏, —Å—Ä–æ—á–Ω–æ—Å—Ç—å)
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —É—Å–ª–æ–≤–∏–π –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏ –∏ —Ä–∞—Å–∫–ª–∞–¥–∫–æ–π
- ‚úÖ **–ë–µ–∑ —Ö–∞—Ä–¥–∫–æ–¥–∞** - –≤—Å–µ —Ü–µ–Ω—ã –∏–∑ –ë–î

### 3. **CRUD API –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π**
üìÅ `backend/src/modules/products/controllers/operationsController.ts`
üìÅ `backend/src/modules/products/routes/operations.ts`

API endpoints:
- ‚úÖ `GET /api/operations` - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ `GET /api/operations/:id` - –¥–µ—Ç–∞–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏
- ‚úÖ `POST /api/operations` - —Å–æ–∑–¥–∞—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é
- ‚úÖ `PUT /api/operations/:id` - –æ–±–Ω–æ–≤–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é
- ‚úÖ `DELETE /api/operations/:id` - —É–¥–∞–ª–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é
- ‚úÖ `GET /api/products/:productId/operations` - –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ–¥—É–∫—Ç–∞
- ‚úÖ `POST /api/products/:productId/operations` - –¥–æ–±–∞–≤–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é –∫ –ø—Ä–æ–¥—É–∫—Ç—É
- ‚úÖ `DELETE /api/products/:productId/operations/:linkId` - —É–¥–∞–ª–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é –∏–∑ –ø—Ä–æ–¥—É–∫—Ç–∞

### 4. **–¢–∏–ø—ã –æ–ø–µ—Ä–∞—Ü–∏–π**

| –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä—ã |
|-----|----------|---------|
| `print` | –ü–µ—á–∞—Ç—å | –¶–∏—Ñ—Ä–æ–≤–∞—è —Ü–≤–µ—Ç–Ω–∞—è/—á/–± |
| `cut` | –†–µ–∑–∫–∞ | –ì–∏–ª—å–æ—Ç–∏–Ω–∞, —Å–∫—Ä—É–≥–ª–µ–Ω–∏–µ —É–≥–ª–æ–≤ |
| `fold` | –§–∞–ª—å—Ü–æ–≤–∫–∞ | 1-2 —Å–≥–∏–±–∞ |
| `score` | –ë–∏–≥–æ–≤–∫–∞ | –î–ª—è –ø–ª–æ—Ç–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ |
| `laminate` | –õ–∞–º–∏–Ω–∞—Ü–∏—è | –ì–ª—è–Ω—Ü–µ–≤–∞—è, –º–∞—Ç–æ–≤–∞—è |
| `bind` | –ü–µ—Ä–µ–ø–ª–µ—Ç | –°–∫–æ–±–∞, –ø—Ä—É–∂–∏–Ω–∞, –∫–ª–µ–π |
| `perforate` | –ü–µ—Ä—Ñ–æ—Ä–∞—Ü–∏—è | –û—Ç—Ä—ã–≤–Ω–∞—è –ª–∏–Ω–∏—è |
| `emboss` | –¢–∏—Å–Ω–µ–Ω–∏–µ | –ö–æ–Ω–≥—Ä–µ–≤ |
| `foil` | –§–æ–ª—å–≥–∏—Ä–æ–≤–∞–Ω–∏–µ | –ó–æ–ª–æ—Ç–æ, —Å–µ—Ä–µ–±—Ä–æ |
| `design` | –î–∏–∑–∞–π–Ω | –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –º–∞–∫–µ—Ç–∞ |
| `other` | –ü—Ä–æ—á–µ–µ | –ü—Ä–æ–≤–µ—Ä–∫–∞, —É–ø–∞–∫–æ–≤–∫–∞ |

### 5. **–ï–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è**

- `per_sheet` - –∑–∞ –ª–∏—Å—Ç (–ø–µ—á–∞—Ç—å, –ª–∞–º–∏–Ω–∞—Ü–∏—è)
- `per_item` - –∑–∞ –∏–∑–¥–µ–ª–∏–µ (—Ä–µ–∑–∫–∞, —Ñ–∞–ª—å—Ü–æ–≤–∫–∞)
- `per_m2` - –∑–∞ –º¬≤ (—à–∏—Ä–æ–∫–æ—Ñ–æ—Ä–º–∞—Ç–Ω–∞—è –ø–µ—á–∞—Ç—å)
- `per_hour` - –∑–∞ —á–∞—Å —Ä–∞–±–æ—Ç—ã
- `fixed` - —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (–¥–∏–∑–∞–π–Ω)

### 6. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**
üìÅ `docs/flexible-calculator-system.md`

–ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã:
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- –¢–∞–±–ª–∏—Ü—ã –ë–î
- –¢–∏–ø—ã –æ–ø–µ—Ä–∞—Ü–∏–π
- –ü—Ä–∞–≤–∏–ª–∞ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è
- API endpoints
- –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ —á–µ—Ä–µ–∑ –æ–ø–µ—Ä–∞—Ü–∏–∏

1. **–°–æ–∑–¥–∞—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏** (–µ—Å–ª–∏ –µ—â–µ –Ω–µ—Ç):
```bash
POST /api/operations
{
  "name": "–¶–∏—Ñ—Ä–æ–≤–∞—è –ø–µ—á–∞—Ç—å A4",
  "operation_type": "print",
  "price": 0.10,
  "price_unit": "per_sheet",
  "setup_cost": 0,
  "parameters": {"color_mode": "cmyk"}
}
```

2. **–ü—Ä–∏–≤—è–∑–∞—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏ –∫ –ø—Ä–æ–¥—É–∫—Ç—É**:
```bash
POST /api/products/1/operations
{
  "operation_id": 1,
  "sequence": 1,
  "is_required": true,
  "price_multiplier": 1.0
}
```

3. **–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ü–µ–Ω—É** (—á–µ—Ä–µ–∑ `FlexiblePricingService`):
```typescript
const result = await FlexiblePricingService.calculatePrice(
  productId,
  configuration,
  quantity
);
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

‚úÖ **–ë–µ–∑ —Ö–∞—Ä–¥–∫–æ–¥–∞** - –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏ —Ü–µ–Ω—ã –≤ –ë–î  
‚úÖ **–ì–∏–±–∫–æ—Å—Ç—å** - –Ω–æ–≤—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É  
‚úÖ **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ** - –æ–ø–µ—Ä–∞—Ü–∏–∏ –æ–±—â–∏–µ –¥–ª—è –º–Ω–æ–≥–∏—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤  
‚úÖ **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ** - –ø—Ä–∞–≤–∏–ª–∞ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏  
‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ç–∏–ø—ã –æ–ø–µ—Ä–∞—Ü–∏–π  

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –î–ª—è –ø–æ–ª–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:

1. **–û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –ø—Ä–æ–¥—É–∫—Ç–æ–≤** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `FlexiblePricingService` –≤–º–µ—Å—Ç–æ `RealPricingService`
2. **–ê–¥–º–∏–Ω–∫–∞ –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π** - UI –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ –∏ –∏—Ö —Å–≤—è–∑—è–º–∏
3. **–ü—Ä–∞–≤–∏–ª–∞ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è** - UI –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–∞–≤–∏–ª (—Å–∫–∏–¥–∫–∏, –Ω–∞–¥–±–∞–≤–∫–∏)
4. **–ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤** - –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –Ω–∞ –Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É –æ–ø–µ—Ä–∞—Ü–∏–π

### –î–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞:

1. **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç –≤—ã–±–æ—Ä–∞ –æ–ø–µ—Ä–∞—Ü–∏–π** - –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø—Ä–æ–¥—É–∫—Ç–∞
2. **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞** - –ø–æ–∫–∞–∑–∞—Ç—å —Ä–∞–∑–±–∏–≤–∫—É —Ü–µ–Ω—ã –ø–æ –æ–ø–µ—Ä–∞—Ü–∏—è–º
3. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤–∏–ª** - UI –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª–∞–º–∏ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è

## –ü—Ä–∏–º–µ—Ä —Ä–∞—Å—á–µ—Ç–∞

### –í–∏–∑–∏—Ç–∫–∏ 90x50, 100 —à—Ç

**–û–ø–µ—Ä–∞—Ü–∏–∏:**
- –ü–µ—á–∞—Ç—å —Ü–∏—Ñ—Ä–æ–≤–∞—è: 10 –ª–∏—Å—Ç–æ–≤ √ó 0.15 = 1.50 BYN
- –†–µ–∑–∫–∞: 10 –ª–∏—Å—Ç–æ–≤ √ó 0.01 + 5 (–ø—Ä–∏–ª–∞–¥–∫–∞) = 5.10 BYN
- –ú–∞—Ç–µ—Ä–∏–∞–ª: 10 –ª–∏—Å—Ç–æ–≤ √ó 0.40 = 4.00 BYN

**–ò—Ç–æ–≥–æ:**
- –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å: 10.60 BYN
- –ù–∞—Ü–µ–Ω–∫–∞ 2.2√ó: 23.32 BYN
- –¶–µ–Ω–∞ –∑–∞ –≤–∏–∑–∏—Ç–∫—É: 0.23 BYN

## –°—Ç–∞—Ç—É—Å

‚úÖ **–ú–∏–≥—Ä–∞—Ü–∏—è** - –ø—Ä–∏–º–µ–Ω–µ–Ω–∞  
‚úÖ **–°–µ—Ä–≤–∏—Å —Ä–∞—Å—á–µ—Ç–∞** - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω  
‚úÖ **CRUD API** - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω  
‚úÖ **Seed –¥–∞–Ω–Ω—ã—Ö** - –¥–æ–±–∞–≤–ª–µ–Ω  
‚úÖ **–¢–µ—Å—Ç—ã** - –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ  
‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - –Ω–∞–ø–∏—Å–∞–Ω–∞  

**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üöÄ

---

**–î–∞—Ç–∞:** 2025-02-02  
**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–°–∏—Å—Ç–µ–º–∞:** CRM –¥–ª—è —Ç–∏–ø–æ–≥—Ä–∞—Ñ–∏–∏

