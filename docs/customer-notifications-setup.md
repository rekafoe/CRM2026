# Настройка уведомлений клиентам (email / SMS)

Документ описывает, как настроить отправку уведомлений клиентам о готовности заказа (email и при необходимости SMS). **Функциональность уведомлений в CRM пока не реализована** — это плановая доработка; ниже — как будет настраиваться агент отправки.

---

## 1. Планируемая логика

- При переходе заказа в статус «Готов» / «Выполнен» или «Передан в ПВЗ» — отправлять клиенту:
  - **Email** (если указан `customerEmail` у заказа или у клиента);
  - **SMS** (опционально, по `customerPhone`).
- Текст письма/смс: номер заказа, статус, при необходимости ссылка на страницу заказа или ПВЗ.

Реализация будет добавлена в бэкенд (сервис уведомлений + вызов при смене статуса заказа). Здесь — только настройка каналов отправки.

---

## 2. Почтовый агент (Email)

Отправка писем обычно идёт через **SMTP**. Варианты:

### 2.1. Переменные окружения (рекомендуемый способ)

В `.env` или в настройках сервера задать:

```env
# SMTP для исходящей почты (уведомления клиентам)
SMTP_HOST=smtp.example.com
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=notifications@yourcompany.by
SMTP_PASS=your-app-password
SMTP_FROM="Печать Онлайн <notifications@yourcompany.by>"
```

- **SMTP_HOST** — хост SMTP-сервера (например, `smtp.gmail.com`, `smtp.mail.ru`, `smtp.yandex.ru` или корпоративный SMTP).
- **SMTP_PORT** — порт (часто 587 для TLS, 465 для SSL, 25 без шифрования).
- **SMTP_SECURE** — `true` для порта 465 (SSL).
- **SMTP_USER** / **SMTP_PASS** — логин и пароль (для Gmail лучше «пароль приложения», не основной пароль).
- **SMTP_FROM** — адрес и при необходимости имя отправителя в письмах.

В коде бэкенда при реализации сервиса уведомлений можно использовать, например, **nodemailer**:

```ts
import nodemailer from 'nodemailer'

const transporter = nodemailer.createTransport({
  host: process.env.SMTP_HOST,
  port: Number(process.env.SMTP_PORT) || 587,
  secure: process.env.SMTP_SECURE === 'true',
  auth: process.env.SMTP_USER ? {
    user: process.env.SMTP_USER,
    pass: process.env.SMTP_PASS,
  } : undefined,
})
```

### 2.2. Примеры для популярных почт

| Провайдер   | SMTP_HOST         | SMTP_PORT | Примечание                          |
|------------|--------------------|-----------|-------------------------------------|
| Gmail      | smtp.gmail.com     | 587       | Включить «Ненадёжные приложения» или использовать OAuth2 / пароль приложения |
| Yandex     | smtp.yandex.ru     | 587       | Пароль приложения в настройках почты |
| Mail.ru    | smtp.mail.ru       | 587       | Аналогично                           |
| Корпоратив.| свой smtp.сервер   | 25/587/465| По инструкции хостинга/IT           |

После реализации модуля уведомлений отправка «Заказ готов» будет вызываться при смене статуса заказа; письма пойдут через этот транспорт.

---

## 3. SMS-оповещения

Для SMS обычно используют внешний API (шлюз оператора или агрегатор).

### 3.1. Переменные окружения (общий шаблон)

```env
# SMS (опционально)
SMS_PROVIDER=twilio
SMS_ACCOUNT_SID=your-account-sid
SMS_AUTH_TOKEN=your-auth-token
SMS_FROM_NUMBER=+375291234567
```

Или для другого провайдера (например, локальный шлюз):

```env
SMS_PROVIDER=local
SMS_GATEWAY_URL=https://sms-gateway.example.com/send
SMS_API_KEY=your-api-key
```

### 3.2. Варианты провайдеров

- **Twilio** — международный сервис, есть документация и API; для РБ нужно проверить доступность номеров и тарифы.
- **Локальный SMS-шлюз оператора** — многие белорусские операторы/хостинги дают HTTP API для отправки SMS по ключу или логину/паролю; параметры (URL, ключ, имя отправителя) задаются в env.
- **Агрегаторы (например, sms.ru, smsc.ru и т.п.)** — подключаются по HTTP API; в коде один сервис «отправить SMS», внутри — вызов выбранного провайдера по `SMS_PROVIDER`.

В реализации достаточно одного интерфейса «sendSms(phone, text)», внутри — чтение `process.env.SMS_*` и вызов нужного API.

---

## 4. Итог

| Канал | Что настроить | Где хранить |
|-------|----------------|-------------|
| Email | SMTP: хост, порт, пользователь, пароль, от кого | `SMTP_*` в `.env` |
| SMS   | Провайдер, ключи/токены, номер отправителя или URL шлюза | `SMS_*` в `.env` |

После реализации системы уведомлений в CRM достаточно будет задать эти переменные и при смене статуса заказа клиент начнёт получать письма и при включённой опции — SMS. Пасхалка: сама система уведомлений ещё будет реализована; настройка агентов делается именно так.
