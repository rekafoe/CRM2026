# Заказы: статусы, операции и API

## Статусы (enum)

- 0 — ожидает (по умолчанию, заказ в пуле и может быть переназначен)
- 1 — оформлен
- 2 — принят в работу (в этом статусе подтверждаются резервы склада)
- 3 — выполнен
- 4 — передан в пункт выдачи
- 5 — получен в пункте выдачи
- 6 — завершён

Онлайн-отмена: для заказов из источников `website` / `telegram` при отмене используется мягкая отмена: `status=0`, `userId=NULL`, `is_cancelled=1`.

## Правила переходов

- Создание заказа → status=0.
- Переназначение между пользователями (по номеру) допустимо только при status=0.
- При переводе в status=2 подтверждаются резервы материалов (если есть).
- Онлайн-отмена не удаляет заказ: переводит в пул, остаётся в истории.

## Поля БД (минимум)

- orders.status: number (0..6)
- orders.createdAt/updatedAt: текстовые таймштампы (camelCase); синхронизированы с created_at/updated_at
- orders.userId: текущий ответственный
- orders.source: NULL | 'website' | 'telegram'
- orders.is_cancelled: 0/1 — мягко отменен (online)

## API

- GET /api/orders — список заказов текущего пользователя
- PUT /api/orders/:id/status — смена статуса
- POST /api/orders/reassign/:number { userId } — переназначение по номеру (только при status=0)
- POST /api/orders/:id/cancel-online — мягкая отмена онлайн-заказа (перевод в пул)

Дополнительно:
- POST /api/orders — создание заказа (status=0)
- POST /api/orders/:id/items — добавление позиции
- DELETE /api/orders/:id — удаление (для не-online заказов)

## Замечания

- Для фронтенда: показывать отметку “Отменён (online)” если status=0 и is_cancelled=1.
- Для фильтров: добавьте фильтрацию по статусам и флагу is_cancelled.
